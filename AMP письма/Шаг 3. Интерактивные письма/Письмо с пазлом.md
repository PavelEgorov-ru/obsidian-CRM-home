Полный пример письма

Цель этого письма — заставить пользователя "собрать" баннер из 9 частей-пазлов. Изначально пользователь видит сетку 3x3, где каждая ячейка является интерактивным элементом - каруселью. Когда пользователь правильно взаимодействует со всеми 9 ячейками, сетка исчезает, а на ее месте появляются цельная картинка и кнопка с призывом к действию.

В самом начале мы определяем компонент `<amp-state>`, который формирует начальное состояние нашей "игры":

```
<amp-state id="state">   
	<script type="application/json">     
		{       
			"image1": 1,       
			"image2": 1,       
			/* ... и так до image9 ... */       
			"image9": 1     
		}   
	</script> 
</amp-state>
```

Мы создаем 9 переменных: `image1`, `image2`, ... `image9`. Каждая из них по умолчанию равна `1`.
Каждая переменная отслеживает состояние одной из 9 ячеек-пазлов. Можно считать, что `1` — это "начальное/неправильное" состояние, а `2` будет "конечным/правильным" состоянием.

Конкретно для этого письма это не так важно, но важно помнить следующее:
Все элементы в AMP письмах должны иметь дефолтное состояние. Состояние письма в `<amp-state>` при загрузке письма не вычисляется. Не нужно полагаться на это состояние при загрузке письма, когда придумываете логику.

Интерактивные элементы — это 9 компонентов `<amp-carousel>`, расположенных в таблице 3x3. Рассмотрим один из них, так как они все работают по одному принципу:

```
<amp-carousel ... on="slideChange:AMP.setState({state:{image1: event.index + 1}})">
	<amp-img src=".../1-1.jpg" ...></amp-img>
	<amp-img src=".../1-2.jpg" ...></amp-img> 
</amp-carousel>
```

`<amp-carousel>` с двумя изображениями внутри. Пользователь может переключаться между ними (слайд 0 и слайд 1).
``
`on="slideChange"`. Этот атрибут говорит, что нужно выполнить действие каждый раз, когда пользователь меняет слайд в карусели.

При первом действии с любым из 9 компонентов происходит инициализация `amp-state`

`AMP.setState({state:{image1: event.index + 1}})`

- `AMP.setState` — команда для изменения состояния.
- `{state: ...}` — мы указываем, что хотим изменить данные внутри `<amp-state id="state">`.
- `image1: event.index + 1` — это ключевая логика. `event.index` — это специальная переменная, которую предоставляет `amp-carousel`. Она равна номеру текущего слайда (0 для первого, 1 для второго).
- Когда пользователь находится на первом слайде, `event.index` равен `0`, и `image1` становится `0 + 1 = 1`.
- Когда пользователь переключается на второй слайд, `event.index` равен `1`, и `image1` становится `1 + 1 = 2`.

Каждая из 9 каруселей привязана к своей переменной (`image1`, `image2` и т.д.). Переключая карусель на второй слайд, пользователь меняет значение соответствующей переменной в `amp-state` с `1` на `2`.

Теперь самое интересное: как система реагирует на то, что все переменные стали равны `2`. Это достигается с помощью привязки к атрибуту `[hidden]`.

В коде есть три элемента, видимость которых зависит от состояния:
1. Таблица с интерактивными каруселями. Она должна скрыться, когда соберутся все слайды. `<table ... [hidden]="... == '222222222'">`
2. Собранная целевая картинка, которая "подменяет" исчезнувшую таблицу с интерактивными каруселями `<amp-img ... [hidden]="... != '222222222'">`
3. Кнопка, которая ведет на целевую страницу `<div class="button-container" ... [hidden]="... != '222222222'">`

Разберем выражение `[hidden]`: `[state.image1, state.image2, ..., state.image9].join('')`

- `[state.image1, ...]` — это выражение создает массив из текущих значений всех наших 9 переменных.
- `.join('')` — этот метод объединяет все элементы массива в одну строку.

В самом начале все переменные равны `1`. Выражение с `join` создаст строку  `'111111111'`.
Проверяется условие для таблицы с интерактивными каруселями:  `[hidden]="'111111111' == '222222222'"`. Это `false`, поэтому атрибут `hidden` не применяется, и таблица **видна**. Проверяем условие для целевой картинки и кнопки: `[hidden]="'111111111' != '222222222'"`. Это `true`, поэтому атрибут `hidden` применяется, и эти элементы **скрыты**. **Ждем следующего действия пользователя.** Пока выражение не станет `222222222`.