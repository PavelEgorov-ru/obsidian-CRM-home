Я делю AMP письма на три больших группы, которые могут быть как самостоятельными, так и включать в себя другие группы.

1. Письма с использованием компонентов, которые отображают контент по новому. В них есть базовая интерактивность. Сюда относятся применение каруселей, сайд-бара и тд.
2. Письма, где логику отображения контента программирует создатель письма. Используется компонент управления внутренним стейтом письма: контент может менять свой вид, появляться или исчезать в зависимости от действий пользователя.
3. Письма, которые получают и отправляют информацию на сервер. Самое простое - подтверждение подписки. Пользователь нажал кнопку, письмо отправило данные на сервер, получило ответ, который можно использовать для отображения успеха подтверждения.  Это "качественный скачок" в создании AMP писем. Здесь требуется не только сделать само письмо, но и развернуть, поддерживать и защищать серверную часть. Здесь появляются требования к CORS, проверка заголовков `AMP-Email-Sender`, защита от атак. 

На самом деле в этой классификации далеко не все так однозначно, но для старта я пока оставлю именно это разделение. К нему мы будем возвращаться ни один раз.

При создании писем эти группы можно и, самое главное, нужно комбинировать между собой.

Начнем создание письма используя стартовую [заготовку](https://github.com/PavelEgorov-ru/obsidian-CRM-home/blob/main/Примеры%20писем/ШАГ%201%20стартовый%20шаблон%20письма.html)

Для удобства разработки писем рекомендую использовать в теге head следующую строку:
`<meta name="viewport" content="width=device-width, initial-scale=1.0">` Она нужна для того, чтобы можно было проверять поведение письма при изменении разрешения экрана. Эта строчка не валидная с точки зрения валидатора AMP. Поэтому перед тестированием писем в песочнице эту строчку нужно закомментировать.

### использование amp-img

В любом письме почти наверняка используются изображения. Обычный тег для изображений `img` запрещен в AMP письмах. Вместо него следует использовать тег `amp-img`.

Обязательные атрибуты:
- `src`
- `width`
- `height`

Разрешенные атрибуты:
- `alt`

Есть еще несколько разрешенных атрибутов, но я намеренно не указываю их здесь. Они появятся в нужный момент в будущем.

В теге `amp-img` запрещено использовать часть атрибутов обычного тега `img`:
- `style` - есть значительные ограничения в использовании. В amp тегах можно указывать CSS стили `width` и  `height`, но только в том случае, если `layout="fixed"`  Размер стилей в атрибуте не должен превышать 1000 байт. Этот размер учитывается в общем лимите на размер указанных стилей в 75Kb. В целом, я не вижу смысла использовать инлайновые стили в AMP письмах
- атрибуты обработчиков событий  `onclick`,  `onmouseover` 
- атрибут ленивой загрузки `loading="lazy"` . `amp-img` - делает это по умолчанию.
- адаптивные атрибуты  `srcset`,  `sizes`
- устаревшие атрибуты форматирования `align`, `border`, `hspace`, `vspace` 

Вместо адаптивных атрибутов в AMP элементах используется атрибут `layout` О нем поговорим позже.

В целом использование компонента максимально простое. В основных кейсах это такой же тег `img` , без устаревших атрибутов и атрибутов, не используемых в email верстке.

Пример использования

```
<amp-img class="banner" src="https://rassylka.static1-sima-land.com/ftp_rassylka/000032743-1/0000.png" layout="responsive" width="600" height="400" alt="Новогодний набор БУКВА-ЛЕНД">
</amp-img>
```

### Первая важная особенность в вёрстке AMP писем.

Одной из главных оптимизаций в AMP является предотвращение скачков контента. Для этого перед рендером html разметки движок браузера или почтовика должен знать все размеры элементов:
- размеры основных блочных и инлайновых тегов вычисляются в соответствии с встроенными и костюмными стилями.
- размеры элементов с "внешним источником" нужно указывать заранее. Поэтому для компонента `amp-img` атрибуты размера элемента обязательны.

### Вторая важная особенность в вёрстке AMP писем. Layout. Первое знакомство на примере изображений.

Всем AMP компонентам лучше явно указывать то, как он будет себя вести при различных разрешениях экрана. Адаптивность.

Демонстрацию элементов с разными параметрами атрибута `layout` можно посмотреть на [странице документации](https://amp.dev/documentation/guides-and-tutorials/learn/amp-html-layout/layouts_demonstrated#fill).

#### fill
Элемент заполняет все доступное пространство родителя. В этом случае `width` и `height` у элемента игнорируются. Размеры, которые нужно зарезервировать, берутся у родителя. Поэтому их важно указать. Еще одним требованием является свойство родителя `position`. Оно должно быть либо `relative`, либо `absolute`. У дочернего компонента AMP, при `layout="fill"`, значение `position` по умолчанию `absolute`. Остальным дочерним элементам это свойство нужно указывать явно.

```

без указания размеров и позиционирования у родителя section class="content", amp-img займет все доступное пространство начиная с body. В данном случае body первый элемент-обертака amp-img, у которого указан position: relative
 

<div class="content-fill">
	<amp-img class="banner" src="https://rassylka.static1-sima-land.com/ftp_rassylka/000032743-1/0000.png" layout="fill" alt="Новогодний набор БУКВА-ЛЕНД"></amp-img>
	<p class="text">Разные примеры использования атрибута layout</p>
</div>
```


```
сделаем section class="content-fill" первым родителем, кого указан position. Теперь amp-img с layout="fill" имеет свойство position: absolute по умолчанию, он берет размеры родителя 400 на 500 px и занимает это пространство. 

p class="text-fill" остается невидимым, т.к. у него position не указан явно

.content-fill {
	position: relative;
	width: 400px;
	height: 500px;
}

<div class="content-fill">
	<amp-img class="banner-fill" src="https://rassylka.static1-sima-land.com/ftp_rassylka/000032743-1/0000.png" layout="fill" alt="Новогодний набор БУКВА-ЛЕНД"></amp-img>
	<p class="text-fill">amp-img занял размеры первого родителя, у кого указано свойтсво position </p>
	<p class="text-fill">Т.к у текста еще не указано свойсвто position, он не будет виден </p>
</div>
```

```
Указываем p class="text-fill" position явно

.content-fill {
	position: relative;
	width: 400px;
	height: 500px;
}

.text-fill {
	position: relative;
}

<div class="content-fill">
	<amp-img class="banner-fill" src="https://rassylka.static1-sima-land.com/ftp_rassylka/000032743-1/0000.png" layout="fill" alt="Новогодний набор БУКВА-ЛЕНД"></amp-img>
	<p class="text-fill">теперь этот текст виден </p>
	<p class="text-fill">Ураааа!! </p>
</div>
```

Более подробно в доступной форме про работу с позиционированием можно посмотреть в [Доке](https://doka.guide/css/position/).


#### fixed

Элемент имеет фиксированные неизменяемы размеры. В принципе все достаточно просто. Раз элемент имеет фиксированные значения, значит для него становятся обязательными атрибуты `width` и `height` 

```
<div>
	<amp-img class="banner-fixed" src="https://rassylka.static1-sima-land.com/ftp_rassylka/000032743-1/0000.png" layout="fixed" width="600" height="200" alt="Новогодний набор БУКВА-ЛЕНД"></amp-img>
</div>
```

При изменении разрешения, если элемент c `layout="fixed"` фиксированную ширину больше ширины экрана, письмо становится некрасивым) Вы это видели часто, если верстали письма.

#### fixed-height

Элемент имеет фиксированную высоту (заданную атрибутом `height`), а его ширина автоматически подстраивается под ширину родительского контейнера. Хоть ширина и подстраивается автоматически, лучше это указывать явно: `width="auto"`

```
<div>
	<amp-img class="banner-fixed-height" src="https://rassylka.static1-sima-land.com/ftp_rassylka/000032743-1/0000.png" layout="fixed-height" width="auto" height="200" alt="Новогодний набор БУКВА-ЛЕНД"></amp-img>
</div>
```

#### intrinsic

Очень похожее поведение на `layout="responsive"`. Элемент масштабируется до тех пор, пока не достигнет своих "естественных" размеров (заданных `width` и `height`). После этого он перестает увеличиваться и центрируется внутри родительского контейнера.
Важно понимать, что про адаптивность можно думать не только в направлении "из большого экрана в маленький", но и наоборот "из маленького экрана на большой". 

Например, я хочу иметь изображение на всю ширину экрана 320px в мобилке, но на десктопе я хочу иметь размер на более 450px в ширину.

```
<div>
	<amp-img class="banner-fixed-height" src="https://rassylka.static1-sima-land.com/ftp_rassylka/000032743-1/0000.png" layout="intrinsic" width="450" height="200" alt="Новогодний набор БУКВА-ЛЕНД"></amp-img>
</div>
```

#### responsive

В большинстве случаев для изображений будет использоваться он. Элемент занимает всю доступную ширину родительского контейнера и автоматически подбирает высоту, чтобы сохранить пропорции, заданные атрибутами `width` и `height`. Если хочется чтобы изображение было на всю ширину и, сохраняя пропорции, подстраивалось под ширину экрана, то нужно использовать именно этот layout.

```
Пример, как работает layout="responsive". Ширина изображения 1200px, высота - 600px. соотношение 2:1. Ширина контейнера - 50% от своего родителя. Какой бы ширины он ни был, amp-img будет сохранять свои пропорции 2:1

.content-responsive {
	max-width: 50%;
}

<div class="content-responsive">
	<amp-img class="banner-responsive" src="https://rassylka.static1-sima-land.com/ftp_rassylka/000032743-1/0000.png" layout="responsive" width="1200" height="600" alt="Новогодний набор БУКВА-ЛЕНД">
	</amp-img>
</div>
```

Есть еще один хитрый layout, который поддерживается в компоненте `amp-img`

#### flex-item

Давайте представим стандартную ситуацию. У вас есть `<amp-img layout="responsive">`. AMP ожидает, что сможет рассчитать его размер, взяв ширину родительского блока.

Теперь представим CSS Flexbox. Flexbox-контейнер (`display: flex`) сам управляет размерами своих дочерних элементов, используя свойства `flex-grow`, `flex-shrink` и `flex-basis`.

**Возникает конфликт:**
- **AMP Layout System:** "Я сам решу, какого размера будет этот `amp-img`!"
- **CSS Flexbox Layout System:** "Нет, я решаю, какого размера будут мои дочерние элементы!"

Атрибут `layout="flex-item"` — это способ сказать AMP-системе: **"Отступи. Позволь Flexbox-контейнеру управлять моим размером"**.

Когда вы используете `layout="flex-item"`, AMP-компонент:
1. **Передает контроль:** Он перестает навязывать свой собственный размер.
2. **Подчиняется Flexbox:** Его размер будет определяться CSS-свойствами `flex`, `align-self` и другими правилами родительского flex-контейнера.
3. **Сохраняет AMP-магию:** При этом он все еще остается AMP-компонентом, то есть AMP-рантайм продолжает управлять его жизненным циклом (например, ленивой загрузкой для `amp-img`).

Если несколько `amp-img` используются в flex-контейнере, то каждому из них нужно дать `layout="flex-item"`

Все разобранные примеры можно посмотреть по [этой ссылке](https://github.com/PavelEgorov-ru/amp-email-1/blob/1/amp-email-1.html).